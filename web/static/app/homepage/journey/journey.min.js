"use strict";angular.module("homepage.journeys",["utils","widget.options","widget.table"]).config(function(){}),angular.module("homepage.journeys").factory("journeyService",["restResource","config",function(e,t){var i=e.$resource,a=e.endpoint("journey");return{id:i(a+":id/",{id:"@id"}),q:i(a,{limit:"@limit",offset:"@offset",device__serial:"@device_serial",start_timestamp__gte:"@start_timestamp",stop_timestamp__lte:"@stop_timestamp"},{get:{method:"GET"}}),getJourneysForDevice:function(e,i,a,o){this.q.get({device__serial:e,start_timestamp__gte:i,stop_timestamp__lte:a,limit:t.get("journey_page_limit")},function(e){o&&o(e)})},lastWeekJourneysForDevice:function(e,t){var i=Date.now(),a=i-6048e5;return getJourneysForDevice(e,a,i,t)}}}]),angular.module("homepage.journeys").controller("journeyController",["$scope","config","messagingService","journeyService",function(e,t,i,a){var o=this;o.options_url=t.get("static_url")+"app/widget/options/options.html",o.table_url=t.get("static_url")+"app/widget/table/table.html",e.domain=e.tabId,e.showPositions=function(e){var i={id:"positions_journey_"+e.id,name:"Positions for journey",active:!0,include:t.get("static_url")+"app/homepage/position/position.html"};o._newDetailTab(i,e)},e.showLogs=function(e){var i={id:"logs_journey_"+e.id,name:"Logs for Journey",active:!0,include:t.get("static_url")+"app/homepage/log/log.html"};o._newDetailTab(i,e)},o._newDetailTab=function(t,a){i.pub(i.DEFAULT_DOMAIN,"TAB_ADD",t),i.pub(i.DEFAULT_DOMAIN,"TAB_SELECT",t),i.sub(e,t.id,"OPTIONS_ON_LOAD",function(e,n){n.devices.readonly=!0,angular.isDefined(o.options)&&(n.devices.selected=o.options.devices.selected),n.journeys.readonly=!0,n.journeys.selected=a,n.startDate.readonly=!0,n.startDate.date=new Date(a.start_timestamp),n.stopDate.readonly=!0,n.stopDate.date=new Date(a.stop_timestamp),n.submit.show=!1,i.pub(t.id,"OPTIONS_SUBMITTED",n)})},i.sub(e,e.domain,"OPTIONS_ON_LOAD",function(e,t){o.options=t,t.devices.show=!0,t.journeys.show=!1,t.startDate.show=!0,t.stopDate.show=!0}),i.sub(e,e.domain,"TABLE_ON_LOAD",function(e,t){o.journeyTable=t,t.columnDefs=[{name:"start_latitude",displayName:"Start Latitude",width:150},{name:"start_longitude",displayName:"Start Longitude",width:150},{name:"start_timestamp",displayName:"Start Timestamp",width:150},{name:"stop_latitude",displayName:"Stop Latitude",width:150},{name:"stop_longitude",displayName:"Stop Longitude",width:150},{name:"stop_timestamp",displayName:"Stop Timestamp",width:150},{name:"distance",displayName:"Distance",width:100},{name:"average_speed",displayName:"Average Speed",width:150},{name:"maximum_speed",displayName:"Maximum Speed",width:150},{name:"duration",displayName:"Duration",width:100},{name:"id",displayName:"",width:100,enableFiltering:!1,cellTemplate:'<button class="btn primary glyphicon glyphicon-eye-open" ng-click="grid.appScope.showPositions(row.entity)"></button><button class="btn primary glyphicon glyphicon-exclamation-sign" ng-click="grid.appScope.showLogs(row.entity)"></button>'}]}),i.sub(e,e.domain,"OPTIONS_SUBMITTED",function(e,t){a.getJourneysForDevice(t.devices.selected.serial,t.startDate.dateString(),t.stopDate.dateString(),function(e){angular.isDefined(o.journeyTable)&&(o.journeyTable.data=e.objects)})})}]);