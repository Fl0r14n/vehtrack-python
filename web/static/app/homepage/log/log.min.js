"use strict";angular.module("homepage.logs",["utils","widget.options","widget.table"]).config(function(){}),angular.module("homepage.logs").factory("logService",["restResource","config",function(e,t){var i=e.$resource,o=e.endpoint("log");return{id:i(o+":id/",{id:"@id"}),q:i(o,{limit:"@limit",offset:"@offset",device__serial:"@device_serial",journey__id:"@journey_id",timestamp__gte:"@start_timestamp",timestamp__lte:"@stop_timestamp",level:"@level"},{get:{method:"GET"}}),getLogsForJourney:function(e,i){this.q.get({journey__id:e,limit:t.get("log_page_limit")},function(e){i&&i(e)})},getLogsForDevice:function(e,t,i,o){this.q.get({device__serial:e,timestamp__gte:t,timestamp__lte:i},function(e){o&&o(e)})}}}]),angular.module("homepage.logs").controller("logController",["$scope","config","messagingService","journeyService","logService",function(e,t,i,o,s){var a=this;a.options_url=t.get("static_url")+"app/widget/options/options.html",a.table_url=t.get("static_url")+"app/widget/table/table.html",e.domain=e.tabId,i.sub(e,e.domain,"OPTIONS_ON_LOAD",function(e,t){t.devices.show=!0,t.journeys.show=!0,t.startDate.show=!0,t.stopDate.show=!0}),i.sub(e,e.domain,"TABLE_ON_LOAD",function(e,t){a.logTable=t,a.logTable.columnDefs=[{name:"timestamp",displayName:"Timestamp",width:200},{name:"level",displayName:"Level",width:100},{name:"message",displayName:"Message",width:300}]}),i.sub(e,e.domain,"OPTIONS_SUBMITTED",function(e,t){o.getJourneysForDevice(t.devices.selected.serial,t.startDate.dateString(),t.stopDate.dateString(),function(e){t.journeys.list=e.objects}),angular.isDefined(t.journeys.selected)&&angular.isObject(t.journeys.selected)?s.getLogsForJourney(t.journeys.selected.id,function(e){angular.isDefined(a.logTable)&&(a.logTable.data=e.objects)}):s.getLogsForDevice(t.devices.selected.serial,t.startDate.dateString(),t.stopDate.dateString(),function(e){angular.isDefined(a.logTable)&&(a.logTable.data=e.objects)})})}]);